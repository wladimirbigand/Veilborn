<!doctype html>
<html lang="fr" data-bs-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Veilborn • Accueil</title>
  <link rel="icon" href="/assets/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Runic&display=swap" rel="stylesheet">
  <style>
    :root{ --brand:#8e7fff; --brand-2:#36d1dc; --footer-h:52px; }
    html,body{ height:100%; margin:0; overflow:hidden; } /* empêche le scroll */
    body{ display:flex; flex-direction:column; background:#000; color:#fff; }
    .btn-runes{
      background:linear-gradient(90deg,var(--brand),var(--brand-2));
      border:0; color:#111; font-weight:700;
      box-shadow:0 0 16px rgba(142,127,255,.25);
      transition:filter .2s, transform .2s;
    }
    .btn-runes:hover{ filter:brightness(1.1); transform:translateY(-2px); box-shadow:0 0 24px rgba(142,127,255,.45); }

    /* HERO occupe tout l'écran - footer */
    .hero{
      position:relative; height:calc(100vh - var(--footer-h));
      display:flex; justify-content:center; align-items:center; text-align:center; overflow:hidden;
    }
    .hero::before{ content:""; position:absolute; inset:0; z-index:-3; background:url('/assets/hero-veilborn.jpg') center/cover no-repeat; filter:brightness(.6); }
    .hero::after{ content:""; position:absolute; inset:0; z-index:-2; background:linear-gradient(180deg, rgba(0,0,0,.4), rgba(0,0,0,.9)); }
    .runes-canvas{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:-1; }

    /* Bloc centré servant d’ancre aux anneaux */
    .hero-core{ position:relative; display:flex; flex-direction:column; align-items:center; gap:.9rem; }
    .hero-logo{ max-width:360px; width:min(40vw,360px); height:auto; }
    .lead{ max-width:60ch; opacity:.9; margin:0; }

    footer{
      position:fixed; left:0; right:0; bottom:0; height:var(--footer-h);
      display:flex; align-items:center; justify-content:center;
      padding:0 .75rem; font-size:.9rem; opacity:.8; border-top:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.6); backdrop-filter: blur(4px);
    }
  </style>
</head>
<body>
  <header class="hero">
    <canvas id="runesCanvas" class="runes-canvas" aria-hidden="true"></canvas>

    <!-- ANCRE CENTRALE -->
    <div class="hero-core" id="heroCore">
      <img src="Assets/VeilbornLogo.png" alt="Logo Veilborn" class="hero-logo" id="veilLogo">
      <p class="lead">Un monde de brumes, de runes et de serments anciens.</p>
      <button class="btn btn-runes btn-lg" data-bs-toggle="modal" data-bs-target="#downloadModal">
        <i class="bi bi-download me-2"></i>Télécharger
      </button>
    </div>
  </header>

  <footer>© <span id="year"></span> Veilborn. Tous droits réservés.</footer>

  <!-- Modal -->
  <div class="modal fade" id="downloadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-body">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-shield-lock me-2"></i>Téléchargement protégé</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="downloadForm" novalidate>
          <div class="modal-body">
            <label for="dlPassword" class="form-label">Clé d'accès</label>
            <input type="password" class="form-control" id="dlPassword" placeholder="Saisissez une clé d'accès" required>
            <div class="invalid-feedback">Veuillez saisir une clé valide.</div>
            <div id="dlError" class="text-danger small mt-2 d-none">Mot de passe incorrect.</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button type="submit" class="btn btn-runes">Continuer</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const DOWNLOAD_URL="index.html",REDIRECT_URL="/Pages/merci.html",PASSWORD_HASH_HEX="e561182894f4b6daf90468eb7e75720972cb25013c89ff9bed838d955513c276";
    function toHex(b){return Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,'0')).join('');}
    async function sha256Hex(s){return toHex(await crypto.subtle.digest('SHA-256',new TextEncoder().encode(s)));}
    document.getElementById('year').textContent=new Date().getFullYear();
    const f=document.getElementById('downloadForm'),p=document.getElementById('dlPassword'),e=document.getElementById('dlError');
    f.addEventListener('submit',async ev=>{ev.preventDefault();if(!f.checkValidity()){f.classList.add('was-validated');return;}
      e.classList.add('d-none');const h=await sha256Hex(p.value);
      if(h===PASSWORD_HASH_HEX.toLowerCase()){window.location.href=DOWNLOAD_URL;setTimeout(()=>window.location.href=REDIRECT_URL,2000);}
      else{e.classList.remove('d-none');p.select();}});
  </script>

  <script>
  (function(){
    const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
    const hero = document.querySelector('.hero');
    const core = document.getElementById('heroCore');
    const canvas = document.getElementById('runesCanvas');
    if(!hero || !core || !canvas) return;
    const ctx = canvas.getContext('2d');

    const CFG = {
      colors:['#8e7fff','#36d1dc'],
      rings:3,
      glyphsPerRing:[18,28,38],
      baseSpeed:[0.0012,-0.0007,0.00018],  /* centre plus rapide, milieu plus lent, extérieur très lent */
      surgeBoost:2.6,
      surgeEveryMinMax:[6000,11000],
      surgeDuration:1600,
      ringGapPx:120,        /* écart fixe entre anneaux (en px) */
      font:"'Noto Sans Runic','Segoe UI Symbol','Inter',system-ui,sans-serif",
      glyphs:"ᚠᚢᚦᚨᚱᚲᚷᚺᚾᛁᛃᛇᛈᛉᛊᛏᛒᛖᛗᛚᛜᛞᛟᛝ✧✦✩✪☽☾",
      glowBlur:22, sharpAlpha:.85, blurAlpha:.35, pulseAmp:.25, pulseSpeed:.0016,
      particleCount:80, particleGlow:14
    };

    let DPR=Math.max(1,Math.min(2,devicePixelRatio||1)),W=0,H=0,CX=0,CY=0,baseR=120;
    let RINGS=[],PARTICLES=[],rafId=null,last=performance.now();

    function rand(a,b){return a+Math.random()*(b-a)}
    function pick(a){return a[(Math.random()*a.length)|0]}

    function resize(){
      const heroRect=hero.getBoundingClientRect();
      const coreRect=core.getBoundingClientRect();
      W=Math.floor(heroRect.width); H=Math.floor(heroRect.height);
      canvas.width=Math.floor(W*DPR); canvas.height=Math.floor(H*DPR);
      canvas.style.width=W+'px'; canvas.style.height=H+'px';
      ctx.setTransform(DPR,0,0,DPR,0,0);

      /* centre EXACT sur le logo/texte/bouton */
      CX = (coreRect.left - heroRect.left) + coreRect.width/2;
      CY = (coreRect.top  - heroRect.top ) + coreRect.height/2;

      /* rayon de base selon la taille du logo (on prend le plus grand côté) */
      const anchor = document.getElementById('veilLogo');
      const aRect = anchor.getBoundingClientRect();
      const anchorSize = Math.max(aRect.width, aRect.height);
      baseR = Math.max( Math.round(anchorSize*0.85), 110 ); /* anneau intérieur effleure le logo */

      buildScene();
      draw(performance.now());
    }

    function buildScene(){
      RINGS.length=0; PARTICLES.length=0;
      for(let i=0;i<CFG.rings;i++){
        const radius = baseR + i*CFG.ringGapPx;
        const n = CFG.glyphsPerRing[i] ?? CFG.glyphsPerRing.at(-1);
        const speed = CFG.baseSpeed[i] ?? CFG.baseSpeed.at(-1) ?? 0.001;
        const glyphs = new Array(n).fill(0).map(()=>({ ch:pick(CFG.glyphs), phase:Math.random()*Math.PI*2 }));
        RINGS.push({ radius, speed, angle:rand(0,Math.PI*2), glyphs, surgeUntil:0, surgeStart:0 });
      }
      for(let i=0;i<CFG.particleCount;i++){
        PARTICLES.push({ x:rand(0,W),y:rand(0,H),vx:rand(-.05,.05),vy:rand(-.05,.05),a:rand(.25,.75),s:rand(.8,2.2),c:pick(CFG.colors),t:rand(0,Math.PI*2) });
      }
      scheduleSurge();
    }

    function scheduleSurge(){
      const delay=rand(...CFG.surgeEveryMinMax);
      setTimeout(()=>{ const r=pick(RINGS); r.surgeStart=performance.now(); r.surgeUntil=r.surgeStart+CFG.surgeDuration; spawnSparksOnRing(r); scheduleSurge(); }, delay);
    }

    function spawnSparksOnRing(ring){
      for(let i=0;i<48;i++){
        const a=rand(0,Math.PI*2), rad=ring.radius+rand(-6,6), x=CX+Math.cos(a)*rad, y=CY+Math.sin(a)*rad;
        PARTICLES.push({ x,y, vx:Math.cos(a)*rand(.25,.7), vy:Math.sin(a)*rand(.25,.7), a:1, s:rand(1.2,2.6), c:pick(CFG.colors), t:0, life:rand(300,700), born:performance.now() });
      }
    }
    function easeOutExpo(x){return x===1?1:1-Math.pow(2,-10*x)}

    function draw(now){
      const dt=now-last; last=now;
      ctx.clearRect(0,0,W,H);

      // léger voile
      const g=ctx.createRadialGradient(CX,CY,0,CX,CY,Math.max(W,H)*.6);
      g.addColorStop(0,'rgba(255,255,255,.05)'); g.addColorStop(1,'rgba(0,0,0,0)');
      ctx.globalCompositeOperation='source-over'; ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

      // particules
      for(const p of PARTICLES){
        p.x+=p.vx; p.y+=p.vy; p.t+=.02;
        if(p.x<-20)p.x=W+20; if(p.x>W+20)p.x=-20; if(p.y<-20)p.y=H+20; if(p.y>H+20)p.y=-20;
        let alpha=p.a*(.6+.4*Math.sin(p.t));
        if(p.life){const age=now-p.born; if(age>p.life){p.a=0; continue;} alpha*=1-age/p.life;}
        ctx.globalAlpha=Math.max(0,alpha); ctx.shadowColor=p.c; ctx.shadowBlur=14; ctx.fillStyle=p.c;
        ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2); ctx.fill();
      }
      ctx.shadowBlur=0; ctx.globalAlpha=1;

      // anneaux centrés sur le logo
      for(const r of RINGS){
        let sp=r.speed; if(now<r.surgeUntil){const t=(now-r.surgeStart)/CFG.surgeDuration; sp*=1+(CFG.surgeBoost-1)*easeOutExpo(Math.min(1,t));}
        r.angle+=sp*dt;
        const n=r.glyphs.length;
        for(let i=0;i<n;i++){
          const th=r.angle+i*(Math.PI*2/n), x=CX+Math.cos(th)*r.radius, y=CY+Math.sin(th)*r.radius;
          const pulse=1+CFG.pulseAmp*Math.sin(now*CFG.pulseSpeed+r.glyphs[i].phase);
          const size=Math.max(18,Math.min(48,(r.radius*.06)*pulse));
          const col=CFG.colors[i%CFG.colors.length];
          ctx.save(); ctx.translate(x,y); ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.font=`${size}px ${CFG.font}`; ctx.fillStyle=col;
          ctx.globalCompositeOperation='lighter'; ctx.globalAlpha=CFG.blurAlpha; ctx.shadowColor=col; ctx.shadowBlur=CFG.glowBlur; ctx.fillText(r.glyphs[i].ch,0,0);
          ctx.globalAlpha=CFG.sharpAlpha; ctx.shadowBlur=0; ctx.fillText(r.glyphs[i].ch,0,0); ctx.restore();
        }
      }
      if(!prefersReduced){ requestAnimationFrame(draw); }
    }

    if(prefersReduced){ resize(); }
    else{
      const ro=new ResizeObserver(resize);
      ro.observe(hero); ro.observe(core);
      addEventListener('orientationchange',resize,{passive:true});
      resize();
      requestAnimationFrame(draw);
      addEventListener('visibilitychange',()=>{ /* pause/reprise auto */ });
    }
  })();
  </script>
</body>
</html>
